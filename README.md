# Padmanabhan et al. Protein Distribution, Dimension and Monte Carlo Analysis Code

## Associated with the _Padmanabhan et al. (Submitted to Cell)

Nirmala Padmanabhan, Rebecca E. Twilley, Grace Jones, Shinichiro Oku, Mir Sohayeb Rabbi, Sandesh Acharya, Mohammed Abrar Basha, Dinu Rajapakse, Cosette Koltek, Nabiha Ameena, Noushin Ahmadpour, Ying Lao, Jiami Guo, Rene Zahedi, Mohiuddin Ahmad, Martin Hruska, Tabrez J. Siddiqui


This repository contains MATLAB and Python scripts used to analysis the protein distribution of hippocampal tissue samples using fluorescence images, and to perform Monte Carlo statistical analysis of protein clustering and nearest-neighbor distances in 3D space.


The sequence of operations:

**1) Imaris Analysis: Centre of Mass & Spot-to-Spot Distance Measurement XTension**
   
**Files:** CentreOfMassToSpots.m, SpotSpotDistance.m, XBatchProcess.m, XBatchProcess_spot.m

**Developed by:** Matthew J. Gastinger (original CentreOfMassToSpots.m), Pierre Pouchin (original XTBatchProcess.m), and Noushin Ahmadpour (SpotSpotDistance.m); scripts customized and modified by Noushin Ahmadpour

This set of MATLAB XTensions enables automated batch quantification of spatial relationships between spot objects in Imaris .ims files.

CentreOfMassToSpots.m converts surface objects into spot objects by extracting their center of homogeneous mass, assigning a fixed 1 µm radius, and preserving original attributes such as color and tracking. The resulting spot object is appended to the Imaris scene.

SpotSpotDistance.m calculates the Euclidean distance from each spot in one protein to all spots in a second protein, saving minimum, mean, and maximum distances to a CSV file. Additionally, it reports the IDs of each minimum-distance pair.

XTBatchProcess.m and XTBatchProcess_spot.m allow batch processing of multiple .ims files using the above scripts across directory trees, saving results to a user-defined folder.
Save each XTension and its corresponding XTBatchProcess.m in a separate folder. To run each function in batch, add the directory to Imaris XTension Folders under Preferences → Custom Tools. The function will then appear under “Image Processing.”

   

**2) Monte Carlo Validation Model**

**Files:** monte_carlo.py

**Developed by:** Rebecca E. Twilley

  This Python script performs a Monte Carlo simulation to quantify enrichment of protein proximity in expansion microscopy .excel files. It compares the observed mean nearest-neighbor distances between protein pairs to a null distribution generated by randomly distributing protein coordinates within a constrained 3D volume. For each protein pair, the script calculates the percent enrichment—defined and saves both real and null distance distributions to Excel files and generates a summary bar plot of enrichment values.


**3) Protein Clustering & Distance Analysis in Python**

**Files:** flag_bassoon_glua2_protein_analysis.py, flag_rim_bassoon_protein_analysis.py, flag_glua1_glua2_protein_analysis.py, flag_rim_cav2_1_protein_analysis.py, flag_rim_homer_protein_analysis.py

**Developed by:** Rebecca E. Twilley

   These Python scripts process 3D localization data of five synaptic proteins set .excel files derived from Imaris. It adjusts raw minimum distances using a user-defined expansion factor to recover actual minimum distances. The script identifies tri-partite interactions under 300 nm, bins the corrected distances into 20 nm intervals, and exports mean distance values for each protein pair across multiple datasets. Optionally, it performs enrichment analysis to count all interactions versus those within a functional complex (<300 nm), and outputs structured Excel files summarizing both raw and filtered results. Angle-based filtering of triads is available but disabled by default. Results are saved as Excel files.



**4) Protein Dimension Analysis**

**Files:** Step_1_dimension_analysis_individual_protein_analysis.py, Step_2_dimension_analysis_merge_proteins.py, Step_3_dimension_analysis_data_visualization.py

**Developed by:** Rebecca E. Twilley

  This three-step pipeline using Python scripts extracts, merges, and visualizes the dimensions of synaptic protein .excel files derived from Imaris.
  
  **Step 1** – Individual Protein Analysis (Step_1_dimension_analysis_individual_protein_analysis.py): This script reads raw volume and bounding box measurements from Imaris (OrientatedObjectOO and Volume tables), applies expansion factor correction, and calculates the true length, width, thickness, and volume for each structure. Results are saved as separate Excel files for each protein.

  **Step 2 (optional)** – Merging Protein Data (Step_2_dimension_analysis_merge_proteins.py): This script combines individual protein .excel files (from Step 1) into a single file per protein, organized by data type (eg. Length, Volume) and generates violin plots of length and volume. 
  
  **Step 3** – Data Visualization (Step_3_dimension_analysis_data_visualization.py): This script compiles merged protein data and produces violin plots for all proteins’ lengths and volumes, with median values, and exports summary statistics to an Excel file.



**5) Additional Files for Graphing Protein Distribution Analysis**

**Files:** add_range_together_columns.py, combine_mean_data_together.py, create_a_graph.py

**Developed by:** Rebecca E. Twilley

  Add_range_together_columns.py and combine_mean_data_together.py combine the range and mean data together obtained from the Protein Clustering & Distance Analysis Python scripts. The merged outputs can then be used by create_a_graph.py for data visualization.

Those scripts have been tested in MATLAB R2021a and Google Colab.

